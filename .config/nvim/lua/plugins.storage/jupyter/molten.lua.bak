return {
	"benlubas/molten-nvim",
	version = "^1.0.0", -- use version <2.0.0 to avoid breaking changes
	dependencies = { "3rd/image.nvim" },
	build = ":UpdateRemotePlugins",
	init = function()
		vim.g.molten_image_provider = "image.nvim"
		vim.g.molten_auto_open_output = false    -- requires a keybind for `:noautocmd MoltenEnterOutput` to open the output if false
		vim.g.molten_wrap_output = false         --
		vim.g.molten_virt_text_output = true	 -- allows outputs to always be shown, works with images, but can be buggy with longer images
		vim.g.molten_virt_lines_off_by_1 = true	 -- this will make it so the output shows up below the \`\`\` cell delimiter

		vim.keymap.set("n", "<leader>mi", "<cmd>MoltenInit<CR>",         { desc = "Initialize Molten", silent = true })
        vim.keymap.set("n", "<leader>ip", "<cmd>MoltenInit python3<CR>", { desc = "Initialize Molten for python3", silent = true })

		-- Provide a command to create a blank new Python notebook
		-- note: the metadata is needed for Jupytext to understand how to parse the notebook.
		-- if you use another language than Python, you should change it in the template.
        local default_notebook = [[
        {
            "cells": [
            {
                "cell_type": "markdown",
                "metadata": {},
                "source": [
                ""
                ]
            }
            ],
            "metadata": {
                "kernelspec": {
                    "display_name": "Python 3",
                    "language": "python",
                    "name": "python3"
                },
                "language_info": {
                    "codemirror_mode": {
                        "name": "ipython"
                    },
                    "file_extension": ".py",
                    "mimetype": "text/x-python",
                    "name": "python",
                    "nbconvert_exporter": "python",
                    "pygments_lexer": "ipython3"
                }
            },
            "nbformat": 4,
            "nbformat_minor": 5
        }
        ]]

		local function new_notebook(filename)
			local path = filename .. ".ipynb"
			local file = io.open(path, "w")
			if file then
				file:write(default_notebook)
				file:close()
				vim.cmd("edit " .. path)
			else
				print("Error: Could not open new notebook file for writing.")
			end
		end

		vim.api.nvim_create_user_command("NewNotebook", function(opts)
			new_notebook(opts.args)
		end, { nargs = 1, complete = "file" })
	end,
}
